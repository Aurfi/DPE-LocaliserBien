#!/usr/bin/env sh

echo "🔍 Running pre-commit checks..."

# Block committing .env files (secrets)
echo "🛑 Checking for .env files in commit..."
STAGED_ENV_FILES=$(git diff --cached --name-only | grep -E '(^|/)\.env(\..*)?$' | grep -Ev '\.env\.example$' || true)
if [ -n "$STAGED_ENV_FILES" ]; then
  echo "❌ Error: .env files detected in commit:"
  echo "$STAGED_ENV_FILES" | sed 's/^/  - /'
  echo "Please remove them from the commit (these files must never be committed)."
  echo "Tip: git restore --staged <file>"
  exit 1
fi

# Run linter
echo "📝 Checking code style with Biome..."
npm run lint || {
  echo "❌ Linting failed! Please fix the issues above."
  exit 1
}

# Check for sensitive data (API keys only)
echo "🔒 Checking for API keys..."
if grep -r "AIzaSy" --include="*.js" --include="*.vue" --include="*.ts" --exclude-dir=node_modules --exclude-dir=dist src/ 2>/dev/null; then
  echo "❌ Error: Google Maps API key found in source code!"
  echo "Please remove API keys from source files and use environment variables instead."
  exit 1
fi

echo "✅ Pre-commit checks passed!"
